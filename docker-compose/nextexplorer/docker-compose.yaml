---
services:
  nextexplorer:
    image: nxzai/explorer:latest
    container_name: nextexplorer
    restart: unless-stopped
    networks:
      - server-backend
    # ports:
    #   - "3000:3000"
    environment:
      - NODE_ENV=production
      - PUBLIC_URL=https://file.${DOMAIN}
      - LOG_LEVEL=info
      # - SESSION_SECRET=please-change-me
      - PUID=${UID}
      - PGID=${UIG}
      # OIDC (optional): enable SSO, see OIDC section below
      - OIDC_ENABLED=true
      - OIDC_ISSUER=https://authentik.${DOMAIN}/application/o/nextexplorer/
      - OIDC_CLIENT_ID=${NEXTEXPLORER_OIDC_CLIENT_ID}
      - OIDC_CLIENT_SECRET=${NEXTEXPLORER_OIDC_CLIENT_SECRET}
      - OIDC_SCOPES=openid profile email groups
      - OIDC_ADMIN_GROUPS=${NEXTEXPLORER_OIDC_ADMIN_GROUPS}
      # - OIDC_REQUIRE_EMAIL_VERIFIED=false
      # OnlyOffice (optional): inâ€‘browser editing for office docs
      # - ONLYOFFICE_URL=https://office.example.com
      # - ONLYOFFICE_SECRET=your-jwt-secret
      # - ONLYOFFICE_LANG=en
      # - ONLYOFFICE_FILE_EXTENSIONS=doc,docx,xls,xlsx,ppt,pptx,odt,ods,odp,rtf,txt,pdf
    volumes:
      - ${DOCKER_DATA}/nextexplorer/config:/config
      - ${DOCKER_DATA}/nextexplorer/cache:/cache
      - ${PROJECT_DATA}:/mnt/Projects
      - ${SHARED_DATA}:/mnt/Nas
    labels:
      - traefik.enable=true
      - traefik.http.routers.nextexplorer.entrypoints=https
      - traefik.http.routers.nextexplorer.rule=Host(`file.${DOMAIN}`)
      - traefik.http.routers.nextexplorer.tls=true
      - traefik.http.services.nextexplorer.loadbalancer.server.port=3000
      - traefik.http.routers.nextexplorer.tls.certresolver=cloudflare
      - traefik.http.routers.nextexplorer.service=nextexplorer

networks:
  server-backend:
    external: true
